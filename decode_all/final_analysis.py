#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
æœ€ç»ˆåˆ†æï¼šä¸ºä»€ä¹ˆEå«é‡è¿™ä¹ˆé«˜ï¼Ÿ
"""

def analyze_amp_characteristics():
    """åˆ†ææŠ—èŒè‚½çš„ç”Ÿç‰©å­¦ç‰¹å¾"""
    print("=== æŠ—èŒè‚½ç”Ÿç‰©å­¦ç‰¹å¾åˆ†æ ===")
    
    print("æŠ—èŒè‚½çš„å…¸å‹ç‰¹å¾:")
    print("1. é˜³ç¦»å­æ€§ (Cationic): å¯Œå«K, Rç­‰å¸¦æ­£ç”µæ°¨åŸºé…¸")
    print("2. ä¸¤äº²æ€§ (Amphipathic): åŒæ—¶å…·æœ‰ç–æ°´å’Œäº²æ°´åŒºåŸŸ") 
    print("3. è†œæ´»æ€§: èƒ½å¤Ÿç ´åç»†èŒç»†èƒè†œ")
    print("4. çŸ­è‚½: é€šå¸¸10-50ä¸ªæ°¨åŸºé…¸")
    
    print("\nå…³äºE (è°·æ°¨é…¸) åœ¨æŠ—èŒè‚½ä¸­çš„ä½œç”¨:")
    print("â€¢ Eæ˜¯å¸¦è´Ÿç”µè·çš„æ°¨åŸºé…¸ (-COOâ»)")
    print("â€¢ åœ¨æŸäº›æŠ—èŒè‚½ä¸­ï¼ŒEå¯èƒ½å‚ä¸:")
    print("  - pHæ•æ„Ÿæ€§è°ƒèŠ‚")
    print("  - ä¸ç»†èƒè†œç£·è„‚å¤´åŸºå›¢çš„ç›¸äº’ä½œç”¨")
    print("  - å½¢æˆç‰¹å®šçš„äºŒçº§ç»“æ„")
    print("  - è°ƒèŠ‚è‚½çš„æ•´ä½“ç”µè·åˆ†å¸ƒ")

def analyze_protdiff_training_bias():
    """åˆ†æProT-Diffè®­ç»ƒå¯èƒ½çš„åå‘"""
    print("\n=== ProT-Diffè®­ç»ƒåå‘åˆ†æ ===")
    
    print("å¯èƒ½çš„Eå«é‡åå‘æ¥æº:")
    print("1. ğŸ¯ è®­ç»ƒæ•°æ®åå‘:")
    print("   - ProT-Diffå¯èƒ½åœ¨ç‰¹å®šçš„AMPæ•°æ®é›†ä¸Šè®­ç»ƒ")
    print("   - è¯¥æ•°æ®é›†å¯èƒ½åŒ…å«å¤§é‡å¯Œå«Eçš„æŠ—èŒè‚½")
    print("   - æ¨¡å‹å­¦ä¹ åˆ°äº†è¿™ç§åˆ†å¸ƒæ¨¡å¼")
    
    print("2. ğŸ¯ ç”Ÿæˆæ¨¡å¼åå‘:")
    print("   - æ‰©æ•£æ¨¡å‹å€¾å‘äºç”Ÿæˆè®­ç»ƒåˆ†å¸ƒçš„'å¹³å‡'")
    print("   - å¦‚æœè®­ç»ƒé›†ä¸­Eé¢‘ç¹å‡ºç°ï¼Œç”Ÿæˆçš„embeddingä¼šç¼–ç è¿™ç§åå‘")
    
    print("3. ğŸ¯ ç»“æ„-åŠŸèƒ½å…³è”:")
    print("   - ProT-Diffå¯èƒ½å­¦ä¹ åˆ°Eä¸æŠ—èŒæ´»æ€§çš„æŸç§å…³è”")
    print("   - å³ä½¿è¿™ç§å…³è”åœ¨ç”Ÿç‰©å­¦ä¸Šä¸å®Œå…¨å‡†ç¡®")

def calculate_expected_vs_observed():
    """è®¡ç®—æœŸæœ›vsè§‚å¯Ÿåˆ°çš„æ°¨åŸºé…¸åˆ†å¸ƒ"""
    print("\n=== æœŸæœ› vs è§‚å¯Ÿåˆ†å¸ƒå¯¹æ¯” ===")
    
    # å¤©ç„¶è›‹ç™½è´¨ä¸­çš„æ°¨åŸºé…¸åˆ†å¸ƒ
    natural_freq = {
        'A': 8.25, 'R': 5.53, 'N': 4.06, 'D': 5.45, 'C': 1.37,
        'Q': 3.93, 'E': 6.75, 'G': 7.07, 'H': 2.27, 'I': 5.96,
        'L': 9.66, 'K': 5.84, 'M': 2.42, 'F': 3.86, 'P': 4.70,
        'S': 6.56, 'T': 5.34, 'W': 1.08, 'Y': 2.92, 'V': 6.87
    }
    
    # æˆ‘ä»¬è§‚å¯Ÿåˆ°çš„åˆ†å¸ƒ (æ¥è‡ªdecoded_final.csvçš„åˆ†æ)
    observed_freq = {
        'A': 1.8, 'C': 1.1, 'D': 5.4, 'E': 17.5, 'F': 4.3,
        'G': 3.0, 'H': 3.1, 'I': 5.7, 'K': 3.9, 'L': 10.4,
        'M': 0.4, 'N': 4.9, 'P': 2.7, 'Q': 6.8, 'R': 6.1,
        'S': 6.9, 'T': 2.7, 'V': 7.2, 'W': 0.1, 'Y': 6.0
    }
    
    print("AA\tå¤©ç„¶%\tè§‚å¯Ÿ%\tåå·®\tå€æ•°")
    print("-" * 40)
    
    for aa in "ACDEFGHIKLMNPQRSTVWY":
        natural = natural_freq.get(aa, 0)
        observed = observed_freq.get(aa, 0)
        bias = observed - natural
        fold_change = observed / natural if natural > 0 else float('inf')
        
        status = ""
        if fold_change > 2:
            status = " ğŸ”¥"
        elif fold_change > 1.5:
            status = " âš ï¸"
        elif fold_change < 0.5:
            status = " â¬‡ï¸"
        
        print(f"{aa}\t{natural:.1f}\t{observed:.1f}\t{bias:+.1f}\t{fold_change:.1f}x{status}")
    
    # é‡ç‚¹åˆ†æE
    e_fold = observed_freq['E'] / natural_freq['E']
    print(f"\n*** Eçš„å¼‚å¸¸ç¨‹åº¦: {e_fold:.1f}å€äºå¤©ç„¶è›‹ç™½è´¨ ***")

def practical_implications():
    """å®é™…åº”ç”¨çš„å½±å“"""
    print("\n=== å®é™…åº”ç”¨å½±å“ ===")
    
    print("Eå«é‡è¿‡é«˜çš„æ½œåœ¨é—®é¢˜:")
    print("1. ğŸ§¬ ç”Ÿç‰©æ´»æ€§å½±å“:")
    print("   - è¿‡å¤šè´Ÿç”µè·å¯èƒ½å½±å“ä¸ç»†èŒè†œçš„ç»“åˆ")
    print("   - æ”¹å˜è‚½çš„æ•´ä½“ç”µè·å¹³è¡¡")
    print("   - å¯èƒ½å½±å“æº¶è§£æ€§å’Œç¨³å®šæ€§")
    
    print("2. ğŸ”¬ ç ”ç©¶å¯ä¿¡åº¦:")
    print("   - ç”Ÿæˆçš„åºåˆ—å¯èƒ½ä¸ä»£è¡¨çœŸå®çš„AMPå¤šæ ·æ€§")
    print("   - éœ€è¦å®éªŒéªŒè¯ç”Ÿç‰©æ´»æ€§")
    
    print("3. ğŸ’Š è¯ç‰©å¼€å‘:")
    print("   - é«˜Eå«é‡åºåˆ—çš„åˆæˆå’Œåˆ¶å¤‡æˆæœ¬")
    print("   - ä½“å†…ç¨³å®šæ€§å’Œä»£è°¢ç‰¹æ€§")

def recommendations():
    """æ”¹è¿›å»ºè®®"""
    print("\n=== æ”¹è¿›å»ºè®® ===")
    
    print("çŸ­æœŸè§£å†³æ–¹æ¡ˆ:")
    print("1. ğŸ›ï¸ è¿›ä¸€æ­¥è°ƒæ•´ç”Ÿæˆå‚æ•°:")
    print("   - repetition_penalty: 1.5-2.0")
    print("   - temperature: 1.5-2.0") 
    print("   - æ·»åŠ no_repeat_ngram_size: 3-4")
    
    print("2. ğŸ” åå¤„ç†è¿‡æ»¤:")
    print("   - è¿‡æ»¤Eå«é‡>15%çš„åºåˆ—")
    print("   - ä¿ç•™æ°¨åŸºé…¸åˆ†å¸ƒæ›´å‡è¡¡çš„åºåˆ—")
    
    print("3. ğŸ¯ å¤šæ ·æ€§é‡‡æ ·:")
    print("   - ä½¿ç”¨diverse beam search")
    print("   - ç”Ÿæˆå¤šä¸ªå€™é€‰åºåˆ—å¹¶é€‰æ‹©æœ€ä½³çš„")
    
    print("\né•¿æœŸè§£å†³æ–¹æ¡ˆ:")
    print("1. ğŸ“Š æ•°æ®é›†åˆ†æ:")
    print("   - åˆ†æProT-DiffåŸå§‹è®­ç»ƒæ•°æ®")
    print("   - ç¡®è®¤æ˜¯å¦ç¡®å®å­˜åœ¨Eåå‘")
    
    print("2. ğŸ”„ æ¨¡å‹é‡è®­ç»ƒ:")
    print("   - ä½¿ç”¨æ›´å¹³è¡¡çš„AMPæ•°æ®é›†")
    print("   - æ·»åŠ æ°¨åŸºé…¸åˆ†å¸ƒçº¦æŸ")
    
    print("3. ğŸ§ª å®éªŒéªŒè¯:")
    print("   - åˆæˆéƒ¨åˆ†ç”Ÿæˆåºåˆ—è¿›è¡Œæ´»æ€§æµ‹è¯•")
    print("   - éªŒè¯é«˜Eå«é‡æ˜¯å¦å½±å“æŠ—èŒæ´»æ€§")

def main():
    print("ğŸ”¬ ProT-Diffç”Ÿæˆåºåˆ—ä¸­Eå«é‡å¼‚å¸¸é«˜çš„æ·±åº¦åˆ†æ")
    print("=" * 60)
    
    analyze_amp_characteristics()
    analyze_protdiff_training_bias()
    calculate_expected_vs_observed()
    practical_implications()
    recommendations()
    
    print("\n" + "=" * 60)
    print("ğŸ¯ æ ¸å¿ƒç»“è®º:")
    print("Eå«é‡å¼‚å¸¸é«˜(17.5% vs å¤©ç„¶6.8%)ä¸»è¦æºäºProT-Diffæ¨¡å‹")
    print("åœ¨è®­ç»ƒæ—¶å­¦ä¹ åˆ°çš„æŠ—èŒè‚½æ•°æ®åˆ†å¸ƒåå‘ï¼Œè¿™æ˜¯é¢†åŸŸç‰¹å®šçš„")
    print("ç°è±¡ï¼Œä¸æ˜¯æŠ€æœ¯bugã€‚éœ€è¦é€šè¿‡è°ƒæ•´ç”Ÿæˆç­–ç•¥æˆ–åå¤„ç†")
    print("æ¥ç¼“è§£è¿™ä¸€é—®é¢˜ã€‚")

if __name__ == "__main__":
    main()
